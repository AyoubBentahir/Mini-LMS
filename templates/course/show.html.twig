{% extends 'base.html.twig' %}

{% block title %}{{ course.title }}{% endblock %}

{% block body %}
<main class="main-area">
    <div class="course-view-header">
        <div class="header-breadcrumb">
            <a href="{{ path('app_course_index') }}" class="breadcrumb-link">
                <i class="fas fa-arrow-left"></i> Retour aux cours
            </a>
        </div>
        
        <div class="header-title-section">
            <div class="course-title-wrapper">
                {% set title_lower = course.title|lower %}
                
                {# Smart Icon Detection #}
                {% if 'math' in title_lower or 'mathématique' in title_lower or 'algèbre' in title_lower or 'géométrie' in title_lower %}
                    {% set icon = 'fa-calculator' %}
                    {% set badge_class = 'math' %}
                    {% set badge_text = 'MATHÉMATIQUES' %}
                {% elseif 'code' in title_lower or 'programmation' in title_lower or 'développement' in title_lower or 'web' in title_lower or 'python' in title_lower or 'javascript' in title_lower or 'php' in title_lower %}
                    {% set icon = 'fa-code' %}
                    {% set badge_class = 'code' %}
                    {% set badge_text = 'PROGRAMMATION' %}
                {% elseif 'design' in title_lower or 'graphique' in title_lower or 'ui' in title_lower or 'ux' in title_lower %}
                    {% set icon = 'fa-palette' %}
                    {% set badge_class = 'design' %}
                    {% set badge_text = 'DESIGN' %}
                {% elseif 'data' in title_lower or 'données' in title_lower or 'analyse' in title_lower or 'statistique' in title_lower %}
                    {% set icon = 'fa-chart-line' %}
                    {% set badge_class = 'data' %}
                    {% set badge_text = 'DATA SCIENCE' %}
                {% elseif 'marketing' in title_lower or 'communication' in title_lower %}
                    {% set icon = 'fa-bullhorn' %}
                    {% set badge_class = 'marketing' %}
                    {% set badge_text = 'MARKETING' %}
                {% elseif 'science' in title_lower or 'physique' in title_lower or 'chimie' in title_lower or 'biologie' in title_lower %}
                    {% set icon = 'fa-flask' %}
                    {% set badge_class = 'science' %}
                    {% set badge_text = 'SCIENCES' %}
                {% elseif 'langue' in title_lower or 'anglais' in title_lower or 'français' in title_lower or 'espagnol' in title_lower %}
                    {% set icon = 'fa-language' %}
                    {% set badge_class = 'language' %}
                    {% set badge_text = 'LANGUES' %}
                {% elseif 'histoire' in title_lower or 'géographie' in title_lower %}
                    {% set icon = 'fa-globe' %}
                    {% set badge_class = 'history' %}
                    {% set badge_text = 'HISTOIRE-GÉO' %}
                {% else %}
                    {% set icon = 'fa-book' %}
                    {% set badge_class = 'general' %}
                    {% set badge_text = 'GÉNÉRAL' %}
                {% endif %}
                
                <div class="course-view-icon">
                    <i class="fas {{ icon }}"></i>
                </div>
                
                <div class="course-title-info">
                    <h1>{{ course.title }}</h1>
                </div>
            </div>
            
            <div class="course-actions-group">
                <a href="{{ path('app_course_edit', {'id': course.id}) }}" class="btn-action-primary">
                    <i class="fas fa-edit"></i> Modifier
                </a>
                <button type="button" class="btn-action-danger" onclick="document.getElementById('deleteForm').style.display='block'">
                    <i class="fas fa-trash"></i> Supprimer
                </button>
            </div>
        </div>
    </div>

    <div class="course-view-grid">
        <div class="course-main-content">
            <div class="info-card">
                <div class="info-card-header">
                    <h2><i class="fas fa-info-circle"></i> Informations du cours</h2>
                </div>
                <div class="info-card-body">
                    <div class="info-row">
                        <span class="info-label">Description</span>
                        <p class="info-value">{{ course.description|default('Aucune description disponible') }}</p>
                    </div>
                    
                    <div class="info-row-grid">
                        <div class="info-item">
                            <span class="info-label">Code unique</span>
                            <div class="code-badge">
                                <i class="fas fa-hashtag"></i>
                                <span>{{ course.codeUnique }}</span>
                            </div>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label">Date de création</span>
                            <div class="date-badge">
                                <i class="fas fa-calendar"></i>
                                <span>{{ course.createdAt ? course.createdAt|date('d/m/Y') : 'N/A' }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-card">
                <div class="info-card-header">
                    <h2><i class="fas fa-layer-group"></i> Modules du cours</h2>
                    <span class="badge-count">{{ course.modules|length }}</span>
                </div>
                <div class="info-card-body">
                    {% if course.modules|length > 0 %}
                        <div class="modules-list">
                            {% for module in course.modules %}
                                <div class="module-item">
                                    <div class="module-number">{{ loop.index }}</div>
                                    <div class="module-details">
                                        <h4>{{ module.title }}</h4>
                                        <span class="module-resources">
                                            <i class="fas fa-file-alt"></i>
                                            {{ module.resources|length }} ressources
                                        </span>
                                    </div>
                                    <a href="{{ path('app_module_show', {'id': module.id}) }}" class="btn-module-view">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-modules">
                            <i class="fas fa-layer-group"></i>
                            <p>Aucun module créé pour ce cours</p>
                            <a href="{{ path('app_module_new') }}" class="btn-add-module">
                                Ajouter un module
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="course-sidebar-info">
            <div class="stats-card">
                <h3>Statistiques</h3>
                <div class="stat-item-large">
                    <div class="stat-icon blue">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="stat-details">
                        <span class="stat-value">{{ course.modules|length }}</span>
                        <span class="stat-label">Modules</span>
                    </div>
                </div>
                
                <div class="stat-item-large">
                    <div class="stat-icon green">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-details">
                        {% set total_resources = 0 %}
                        {% for module in course.modules %}
                            {% set total_resources = total_resources + module.resources|length %}
                        {% endfor %}
                        <span class="stat-value">{{ total_resources }}</span>
                        <span class="stat-label">Ressources</span>
                    </div>
                </div>
                
                <div class="stat-item-large">
                    <div class="stat-icon purple">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <span class="stat-value">0</span>
                        <span class="stat-label">Étudiants</span>
                    </div>
                </div>
            </div>

            <div class="quick-actions-card">
                <h3>Actions rapides</h3>
                <a href="{{ path('app_module_new') }}" class="quick-action-btn">
                    <i class="fas fa-plus-circle"></i>
                    <span>Ajouter un module</span>
                </a>
                <a href="{{ path('app_resource_new') }}" class="quick-action-btn">
                    <i class="fas fa-file-upload"></i>
                    <span>Ajouter une ressource</span>
                </a>
                <a href="{{ path('app_course_index') }}" class="quick-action-btn">
                    <i class="fas fa-list"></i>
                    <span>Voir tous les cours</span>
                </a>
            </div>
        </div>
    </div>

    <div id="deleteForm" class="delete-modal" style="display: none;">
        <div class="delete-modal-content">
            <div class="delete-modal-header">
                <h3><i class="fas fa-exclamation-triangle"></i> Confirmer la suppression</h3>
                <button onclick="document.getElementById('deleteForm').style.display='none'" class="close-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="delete-modal-body">
                <p>Êtes-vous sûr de vouloir supprimer le cours <strong>{{ course.title }}</strong> ?</p>
                <p class="warning-text">Cette action est irréversible et supprimera tous les modules et ressources associés.</p>
            </div>
            <div class="delete-modal-footer">
                <button onclick="document.getElementById('deleteForm').style.display='none'" class="btn-cancel">
                    Annuler
                </button>
                {{ include('course/_delete_form.html.twig') }}
            </div>
        </div>
    </div>
</main>
{% endblock %}
