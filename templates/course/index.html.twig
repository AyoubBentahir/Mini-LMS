{% extends 'base.html.twig' %}

{% block title %}Mes Cours{% endblock %}

{% block body %}
<main class="main-area">
    <div class="page-header-unified">
        <h1>Mes Cours</h1>
        
        <div class="search-wrapper-unified">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Rechercher un cours..." id="courseSearch">
        </div>
        
        <a href="{{ path('app_course_new') }}" class="btn-create-unified">
            <i class="fas fa-plus"></i> Créer Nouveau Cours
        </a>
    </div>

    <div class="course-management-grid">
        {% for course in courses %}
            {% set title_lower = course.title|lower %}
            
            {# Smart Icon Detection #}
            {% if 'math' in title_lower or 'mathématique' in title_lower or 'algèbre' in title_lower or 'géométrie' in title_lower %}
                {% set icon = 'fa-calculator' %}
                {% set badge_class = 'math' %}
                {% set badge_text = 'MATHÉMATIQUES' %}
            {% elseif 'code' in title_lower or 'programmation' in title_lower or 'développement' in title_lower or 'web' in title_lower or 'python' in title_lower or 'javascript' in title_lower or 'php' in title_lower %}
                {% set icon = 'fa-code' %}
                {% set badge_class = 'code' %}
                {% set badge_text = 'PROGRAMMATION' %}
            {% elseif 'design' in title_lower or 'graphique' in title_lower or 'ui' in title_lower or 'ux' in title_lower %}
                {% set icon = 'fa-palette' %}
                {% set badge_class = 'design' %}
                {% set badge_text = 'DESIGN' %}
            {% elseif 'data' in title_lower or 'données' in title_lower or 'analyse' in title_lower or 'statistique' in title_lower %}
                {% set icon = 'fa-chart-line' %}
                {% set badge_class = 'data' %}
                {% set badge_text = 'DATA SCIENCE' %}
            {% elseif 'marketing' in title_lower or 'communication' in title_lower %}
                {% set icon = 'fa-bullhorn' %}
                {% set badge_class = 'marketing' %}
                {% set badge_text = 'MARKETING' %}
            {% elseif 'science' in title_lower or 'physique' in title_lower or 'chimie' in title_lower or 'biologie' in title_lower %}
                {% set icon = 'fa-flask' %}
                {% set badge_class = 'science' %}
                {% set badge_text = 'SCIENCES' %}
            {% elseif 'langue' in title_lower or 'anglais' in title_lower or 'français' in title_lower or 'espagnol' in title_lower %}
                {% set icon = 'fa-language' %}
                {% set badge_class = 'language' %}
                {% set badge_text = 'LANGUES' %}
            {% elseif 'histoire' in title_lower or 'géographie' in title_lower %}
                {% set icon = 'fa-globe' %}
                {% set badge_class = 'history' %}
                {% set badge_text = 'HISTOIRE-GÉO' %}
            {% else %}
                {% set icon = 'fa-book' %}
                {% set badge_class = 'general' %}
                {% set badge_text = 'GÉNÉRAL' %}
            {% endif %}
            
            <div class="course-manage-card" data-course-title="{{ course.title|lower }}" data-description="{{ course.description|default('')|lower }}">
                <div class="course-card-header">
                    <div class="course-icon-wrapper">
                        <i class="fas {{ icon }}"></i>
                    </div>
                </div>
                
                <h3>{{ course.title }}</h3>
                
                <p class="course-description">
                    {{ course.description|default('Aucune description disponible')|length > 80 ? course.description|default('Aucune description disponible')|slice(0, 80) ~ '...' : course.description|default('Aucune description disponible') }}
                </p>
                
                <div class="course-stats">
                    <div class="stat-item">
                        <i class="fas fa-layer-group"></i>
                        <span>{{ course.modules|length }} module{{ course.modules|length > 1 ? 's' : '' }}</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-file-alt"></i>
                        {% set total_resources = 0 %}
                        {% for module in course.modules %}
                            {% set total_resources = total_resources + module.resources|length %}
                        {% endfor %}
                        <span>{{ total_resources }} ressource{{ total_resources > 1 ? 's' : '' }}</span>
                    </div>
                </div>
                
                <div class="course-progress-section">
                    {% set total_modules = course.modules|length %}
                    {% set completed_modules = 0 %}
                    {% for module in course.modules %}
                        {% if module.resources|length > 0 %}
                            {% set completed_modules = completed_modules + 1 %}
                        {% endif %}
                    {% endfor %}
                    {% set progress_percent = total_modules > 0 ? (completed_modules / total_modules * 100)|round : 0 %}
                    
                    <div class="progress-label">
                        <span>Contenu</span>
                        <span class="progress-percentage">{{ progress_percent }}%</span>
                    </div>
                    <div class="course-progress-bar">
                        <div class="course-progress-fill" style="width: {{ progress_percent }}%"></div>
                    </div>
                </div>
                
                <div class="course-card-actions">
                    <a href="{{ path('app_course_show', {'id': course.id}) }}" class="btn-card-action view">
                        <i class="fas fa-eye"></i> Explorer
                    </a>
                    <a href="{{ path('app_course_edit', {'id': course.id}) }}" class="btn-card-action edit">
                        <i class="fas fa-edit"></i> Modifier
                    </a>
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-book-open"></i>
                </div>
                <h3>Aucun cours disponible</h3>
                <p>Commencez par créer votre premier cours pour démarrer votre parcours d'enseignement.</p>
                <a href="{{ path('app_course_new') }}" class="btn-create-course">
                    <i class="fas fa-plus"></i> Créer mon premier cours
                </a>
            </div>
        {% endfor %}
    </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('courseSearch');
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase().trim();
            const courseCards = document.querySelectorAll('.course-manage-card');
            
            courseCards.forEach(card => {
                const title = card.getAttribute('data-course-title') || '';
                const description = card.getAttribute('data-description') || '';
                
                if (title.includes(searchTerm) || description.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    }
});
</script>
{% endblock %}
